{% extends "base/base.html" %}
{% block title %}Order History — Deliver{% endblock %}
{% block navbar %}{% include "base/sidebar_customer.html" %}{% endblock %}
{% block content %}
<div class="topbar">
    <span class="topbar-title"><i class="fa fa-history me-2" style="color:var(--primary-light)"></i>Order History</span>
    <div class="topbar-user">
        <div class="avatar-sm">{{ request.user.first_name|first }}</div>
        <a href="{% url 'logout' %}" class="btn btn-sm btn-outline-danger ms-2"><i class="fa fa-sign-out-alt"></i></a>
    </div>
</div>
<div class="container-fluid py-4">
    <div class="deliver-table">
        <table class="table table-dark table-hover mb-0">
            <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Date</th>
                    <th>Pickup</th>
                    <th>Drops</th>
                    <th>Package</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for b in bookings %}
                <tr>
                    <td><span class="badge"
                            style="background:rgba(108,60,225,.2);color:var(--primary-light);font-size:.8rem">{{ b.booking_id }}</span></td>
                    <td class="small text-muted">{{ b.created_at|date:"d M Y" }}</td>
                    <td>{{ b.pickup_address|truncatechars:25 }}</td>
                    <td>{{ b.get_drop_count }} drop{{ b.get_drop_count|pluralize }}</td>
                    <td>{{ b.get_package_type_display }}</td>
                    <td class="fw-bold">₹{{ b.total_price }}</td>
                    <td><span class="status-badge status-{{ b.status }}">{{ b.get_status_display }}</span></td>
                    <td>
                        <a href="{% url 'customer_tracking' b.booking_id %}"
                            class="btn btn-xs btn-outline-primary btn-sm me-1">
                            <i class="fa fa-map-marker-alt"></i>
                        </a>
                        {% if b.status == 'delivered' and not b.rating %}
                        <a href="{% url 'rate_driver' b.booking_id %}"
                            class="btn btn-xs btn-outline-warning btn-sm me-1">
                            <i class="fa fa-star"></i>
                        </a>
                        {% endif %}
                        {% if b.status in 'pending,confirmed' %}
                        <a href="{% url 'raise_ticket' %}" class="btn btn-xs btn-outline-danger btn-sm">
                            <i class="fa fa-headset"></i>
                        </a>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center py-4 text-muted">No bookings yet. <a
                            href="{% url 'customer_new_booking' %}">Make your first booking!</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}